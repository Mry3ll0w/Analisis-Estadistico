---
title: "A2_Antonio_Rolda_Andrade"
author: "Antonio Roldán Andrade"
date: "2025-11-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Imports necesarios de cara al trabajo a realizar
library(readxl)
library(dplyr)
library(ggplot2)
library(knitr)  # Lo agrego para hacer más bonita la presentación de la última 
```

# 1 Esperanza de Vida

## 1.1 Análisis Descriptivo

Previo al estudio del caso realizo las transformaciones de las columnas para 
mejor legibilidad.

```{r}
# Antes de comenzar abrimos el dataset 
xlsx_location <- "WorldSustainabilityDS_clean.xlsx"
worldSustainabiltyDataSet <- read_excel(xlsx_location)

# Pasamos ahora a renombrar SP.DYN.LE00.IN
worldSustainabiltyDataSet <- worldSustainabiltyDataSet %>%
  rename(LE = `SP.DYN.LE00.IN`)
# Extraemos las columnas necesarias {LE,Income, Region}

dtLEInReg <- worldSustainabiltyDataSet %>% select(LE, Income,Region)

# Grafico comparando Esperanza de vida y nivel de ingresos

grafico1_1 <- ggplot(
  data = dtLEInReg,
  mapping = aes(x = Income, y = LE, fill = Income) # Con fill mostramos por color cada grupo de Income
) +
  geom_boxplot() +
  geom_jitter(
    color = "yellow",
    size = 0.5,
    alpha = 0.5, # Transparencia para evitar superposición
    width = 0.2  # Pequeño desplazamiento horizontal para los puntos
  ) +
  labs(
    title = "Esperanza de Vida (LE) por Nivel de Ingresos",
    x = "Nivel de Ingresos",
    y = "Esperanza de Vida al nacer (Años)",
    fill = "Nivel de Ingresos"
  )
# Mostrar el gráfico
print(grafico1_1)
names(worldSustainabiltyDataSet)

```

## 1.2 Hipótesis
- La pregunta a contrastar es: ¿La esperanza de vida es mayor en los países con alto nivel de ingresos que en el resto?

- Los datos a usar son los pertenencientes a países con ingresos altos (High Income) del 
último año de los datos (2018)

Por tanto, podemos plantear las siguientes hipótesis:
  
  - u1 -> LE High Income
  - u2 -> LE Resto
  - H0: u1 = u2
  - H1: u1 > u2

Realizaremos un test unilateral derecho para verificar la hipótesis nula.

## 1.3 Test

Estamos en un caso en el que se tiene una muestra de datos grandes por lo que se puede 
asumir que la distribución sigue una distribución normal, puesto que la población es 
mayor que 30. Además tratamos de un contraste de hipótesis de dos poblaciones (High Income y el resto) independientes sin varianza conocida.

```{r}
# Realizamos un filtrado extrayendo los datos que necesitamos

# LE de altos ingresos
dt1_3 <- worldSustainabiltyDataSet %>%
  filter(Year == 2018)

# Preparamos la columnas como True o false en caso de High Income o no
dt1_3 <- dt1_3 %>%
  filter(!is.na(LE)) %>% # No usamos las columnas con NA
  # 2. Guardamos el resultado de mutate en IncomeGroup
  mutate(
    IncomeGroup = case_when(
      # Si el ingreso es 'High income', asigna 'Alto Ingreso'
      Income == "High income" ~ "Alto Ingreso",
      # Para cualquier otro caso (el resto de ingresos), asigna 'Resto de Ingresos'
      TRUE ~ "Resto Ingresos"
    )
  )

# Realizamos antes de asumir nada sobre las varianzas si estas son iguales 
alpha <- 1 - 0.95
m1 <- mean(dt1_3$LE[dt1_3$IncomeGroup == 'Alto Ingreso'])
m2 <- mean(dt1_3$LE[dt1_3$IncomeGroup == 'Resto Ingresos'])
n1 <- length(dt1_3$LE[dt1_3$IncomeGroup == 'Alto Ingreso'])
n2 <- length(dt1_3$LE[dt1_3$IncomeGroup == 'Resto Ingresos'])
s1 <- sd(dt1_3$LE[dt1_3$IncomeGroup == 'Alto Ingreso'])
s2 <- sd(dt1_3$LE[dt1_3$IncomeGroup == 'Resto Ingresos'])
fobs <- (s1*s1)/(s2*s2)

fcritL <- qf(alpha/2, df1 = n1-1, df2= n2-1)
fcritU <- qf(1 - alpha/2, df1 = n1-1, df2= n2-1)

# Calculamos el pvalue
pvalue <- min(
  pf(fobs, df1=n1-1, df2=n2-2, lower.tail = FALSE),
  pf(fobs, df1=n1-1, df2=n2-2)
)

c(fobs, fcritL, fcritU, pvalue)

```

Como podemos apreciar se rechaza la hipótesis nula, tanto por caer fuera del intervalo
de confianza como por el valor de pvalue. Por tanto, las varianzas son distintas.

## 1.4 Aplicación del Test Estadístico

```{r}
# Aplicamos t student

t.test(dt1_3$LE[dt1_3$IncomeGroup == 'Alto Ingreso'], dt1_3$LE[dt1_3$IncomeGroup == 'Resto Ingresos'], alternative="greater", var.equal=FALSE)

```

## 1.5 Desarrollo

Dada la situación en la que nos encontramos (varianza desconocida, poblaciones distintas y no dependientes) tendremos que realizar
los siguientes cálculos:

```{r}
# Calculamos el test T de Welch

tWelch <- (m1 - m2) / sqrt( (s1^2/n1) + ( s2^2/n2 ) )

# Calculamos los grados de libertad df

df_num <- ( ( s1^2/n1 ) + (s2^2/n2) )^2
df_den <- ( (s1^2/n1)^2 / (n1-1) ) + ( (s2^2/n2)^2 / (n2-1) ) 
df <- df_num / df_den
# Calculamos el pvalue ==> Queremos comprobar que sea mayor, por lo que unilateral derecho
# Reuso la variable
pvalue <- pt(tWelch, df=df, lower.tail = FALSE)


```

## 1.6 Resultados

```{r, echo=FALSE}
cat("--- Resultados de la Prueba T de Welch (Implementación Propia) ---\n")
cat(sprintf("Media (µ1) Alto Ingreso: %.4f\n", m1))
cat(sprintf("Media (µ2) Resto Ingresos: %.4f\n", m2))
cat(sprintf("Valor Observado (Estadístico t): %.3f\n", tWelch))
cat(sprintf("Grados de Libertad (df): %.2f\n", df))
print("Valor p (unilateral, H1: µ1 > µ2):")
print(pvalue)

```

## 1.7 Interpretación

Como podemos apreciar el valor calculado es muy similar al obtenido al usar la función que nos proporciona el entorno de R, 
por lo que podemos decir con una fiabilidad del 95 % que la hipotesis nula no se cumple, por lo que la hipotesis alternativa
será tomada como correcta, por tanto, podemos afirmar que la esperanza de vida en países con alto ingresos es superior a la 
de países con menores ingresos.



# 2 Desigualdad a lo largo del tiempo

**PR2:  ¿La desigualdad se reduce en un período de 10 años? **

```{r}
# Preparamos los datos: 
# Usamos la columna SI.POV.GINI ==> renombramos a GINI
# Rango de tiempo ==> 2008 a 2018
# Población 1: Todos los países del mundo.
# Población 2: Países de cuya región == “Europe and Northern America”

dt2 <- worldSustainabiltyDataSet %>% rename( GINI = SI.POV.GINI )
worldSustainabiltyDataSet <- worldSustainabiltyDataSet %>% rename( GINI = SI.POV.GINI )

dt2 <- dt2 %>% filter( (Year >= 2008 ) & (Year <=2018 ) )

#Filtramos y preordenados
dt2EuNorthern <- dt2 %>% 
  filter(Region == "Europe and Northern America") %>%
  arrange(desc(GINI))

dt2 <- dt2 %>% arrange(desc(GINI)) # Ordenamos todos los paises
```

## 2.1 Análisis Descriptivo

```{r}
# Gráfico comparativo
dt2 %>%
  filter(!is.na(GINI)) %>%
  mutate(Year = as.factor(Year)) %>% # Para que sirva para el gráfico.
  ggplot(aes(x = Year, y = GINI, fill = Year)) +
  geom_boxplot() + # Solo la caja y bigotes
  labs(
    title = "Desigualdad Global (GINI): 2008 vs 2018",
    x = "Año",
    y = "Índice GINI"
  ) 

dt2EuNorthern %>%
  filter(!is.na(GINI)) %>%
  mutate(Year = as.factor(Year)) %>% # Para que sirva para el gráfico.
  ggplot(aes(x = Year, y = GINI, fill = Year)) +
  geom_boxplot() + # Solo la caja y bigotes
  labs(
    title = "Desigualdad EU y America del Norte (GINI): 2008 vs 2018",
    x = "Año",
    y = "Índice GINI"
  )

# 1. PAÍSES CON MAYOR DESIGUALDAD (GINI más alto)

tbMayorDesigualdadGlobal <- dt2 %>% 
  filter(!is.na(GINI)) %>% 
  arrange(desc(GINI)) %>% 
  head(5) %>%             
  select(GINI, Country, Region, Year)

tbMayorDesigualdadGlobal

tbMayorDesigualdadEuNA <- dt2EuNorthern %>% 
  filter(!is.na(GINI)) %>% 
  arrange(GINI) %>% 
  head(5) %>%        
  select(GINI, Country, Region, Year)

tbMayorDesigualdadEuNA

# 2. PAÍSES CON MENOR DESIGUALDAD (GINI más bajo)

tbMenorDesigualdadEuNA <- dt2EuNorthern %>% 
  filter(!is.na(GINI)) %>% 
  arrange(GINI) %>% 
  tail(5) %>%        
  select(GINI, Country, Region, Year)

tbMenorDesigualdadEuNA

tbMenorDesigualdadGlobal <- dt2 %>% 
  filter(!is.na(GINI)) %>% 
  arrange(GINI) %>% 
  tail(5) %>%        
  select(GINI, Country, Region, Year)

tbMenorDesigualdadGlobal
```

## 2.2 Hipótesis

Siendo la pregunta de investigación:  ¿La desigualdad se reduce en un período de 10 años?
podemos plantear las siguentes hipótesis:

- n1: Población del año 2008, g1 (GINI de 2008)
- n2: Población del año 2018, g2 (GINI 2018)
- Hipótesis Nula (h0): g1 = g2
- Hipótesis Alternativa (h1): g1 > g2


## 2.3 Test

No podemos tratar a esta población como muestras dependientes, puesto que no estamos 
relacionandos los mismos paises entre si, es decir, España 2008 con España 2018.
Además no tenemos una varianza puesto que no tratamos a la variable "Año" como algo
numérico si no de forma categórica.  
Por tanto, tenemos un caso de contraste de hipótesis de dos poblaciones independientes 
con una varianza desconocidas, por lo que usaremos el t de Welch.

## 2.5 Aplicación del Test

```{r}
# Filtramos p
dt2 <- dt2 %>% filter(!(is.na(GINI)))
dt2_2008 <- dt2 %>% filter(Year == 2008)
dt2_2018 <- dt2 %>% filter(Year == 2018)

# Comprovamos igualdad de varianzas
# Realizamos antes de asumir nada sobre las varianzas si estas son iguales 
alpha <- 1 - 0.95
m1 <- mean(dt2_2008$GINI)
m2 <- mean(dt2_2018$GINI)
n1 <- length(dt2_2008$GINI)
n2 <- length(dt2_2018$GINI)
s1 <- sd(dt2_2008$GINI)
s2 <- sd(dt2_2018$GINI)
fobs <- (s1*s1)/(s2*s2)

fcritL <- qf(alpha/2, df1 = n1-1, df2= n2-1)
fcritU <- qf(1 - alpha/2, df1 = n1-1, df2= n2-1)

# Calculamos el pvalue
pvalue <- min(
  pf(fobs, df1=n1-1, df2=n2-1, lower.tail = FALSE),
  pf(fobs, df1=n1-1, df2=n2-1)
)

c(fobs, fcritL, fcritU, pvalue)




```
Como podemos ver en los valores mostrados, las varianzas son iguales (h0), ya que 
se encuentra el valor observado dentro del intervalo de confianza, además el pvalue es mayor que alfa, reforzando así la hipótesis nula.

```{r}
# Haremos un test de Welch para varianzas iguales
t.test(dt2_2008$GINI, dt2_2018$GINI, alternative="greater", var.equal=TRUE)

```

## 2.5 Desarrollo 

```{r}
# 1. Calculamos la Desviación Estándar Combinada (sTotal)
sTotal <- sqrt(
  ((n1 - 1) * s1^2 + (n2-1)*s2^2 ) / (n1+n2-2)
)

# 2. Calculamos el Error Estándar Combinado (SE_pool)
SE_pool <- sTotal * sqrt( (1/n1) + (1/n2) )

# 3. Calculamos el Estadístico t (Valor Observado)
tstobs <- (m1 - m2) / SE_pool

# 4. Calculamos los Grados de Libertad
df <- n1 + n2 - 2

# 5. Calculamos el Valor Crítico (t_crit)
# qt(0.95, df=df) da el t-valor para un test unilateral derecho (alfa=0.05)
tcrit <- qt(0.95, df=df)

# 6. Calculamos el Límite Inferior del IC Unilateral (95%)
# IC_inf = (Diferencia de Medias) - (t_crit * SE_pool)
IC_inferior <- (m1 - m2) - (tcrit * SE_pool)

# 7. Calculamos el p-value (Unilateral Derecho)
pvalue <- pt(tstobs, df=df, lower.tail = FALSE)


```

## 2.6 Resultados

```{r}

tabla_resultados_completa <- data.frame(
  Estadístico = c("Media Grupo 1 (µ₁)", "Media Grupo 2 (µ₂)", "Diferencia de Medias", 
                  "Estadístico t (Observado)", "Grados de Libertad (df)", 
                  "Valor Crítico (tcrit)", "IC 95% Inferior", "Valor p"),
  Valor = c(m1, m2, (m1-m2), tstobs, df, tcrit, IC_inferior, pvalue)
)

# 9. Mostrar la tabla formateada
tabla_resultados_completa$Valor <- round(tabla_resultados_completa$Valor, 6)
print(tabla_resultados_completa)

```

# 2.7 Interpretación

Dado que nos encontramos en una prueba unilateral derecha, y el valor obtenido es de 1.31 y el intervalo de confianza es de [-0.49. inf) `
podemos aceptar la hipótesis nula, viendose esta apoyada por los valores p obtenidos (siendo los mismos superiores a alpha, 0.955).
Por tanto podemos afirmar que la desigualdad no se ha reducido en el mundo durante los años 2008 a 2018.




# 3 Desigualdad según el tipo de régimen

**PR3: ¿La proporción de países con mayor desigualdad es diferente entre los países con régimen
democrático y aquellos con régimen autocrático?**


# 3.1 Preparación de los datos

```{r}
# Agregamos variable HighInequality
# Valores que toma regime son: ELectoral Autocracy, Closed Autocracy, Electoral Democracy, Liberal Democracy

# 1. Preparación de los datos: Filtrar 2018 y crear la variable HighInequality
df_proporciones <- worldSustainabiltyDataSet %>%
  filter(Year == 2018) %>%
  filter(!is.na(GINI) & !is.na(Regime)) %>% 
  mutate(
    HighInequality = ifelse(GINI > 40, 1, 0) # Crear la variable HighInequality (1 si GINI > 40, 0 en caso contrario)
  )

# 2. Calcular la proporción

tabla_proporcion_regimen <- df_proporciones %>%
  # Agrupar por el tipo de régimen
  group_by(Regime) %>%
  # Calcular la proporción de países con HighInequality = 1
  summarise(
    Total_Paises = n(),
    Paises_Alta_Desigualdad = sum(HighInequality),
    Proporcion_Alta_Desigualdad = mean(HighInequality) * 100 # Multiplicamos para %
  ) %>%
  # Desagrupar y renombrar columnas para la tabla final (mayor legilibilidad)
  ungroup() %>%
  select(
    Regimen = Regime,
    `Países` = Total_Paises,
    `Países GINI > 40` = Paises_Alta_Desigualdad,
    `Proporción (%)` = Proporcion_Alta_Desigualdad
  )

# Mostrar la tabla de resultados
print(tabla_proporcion_regimen)

```

## 3.2 Hipótesis

Teniendo la pregunta PR3, extraemos lo siguiente:  

- Población 1: Proporción desigualdad régimen democrático
- Poblacion 2: Proporción de países régimen autocrático

- Hipótesis Nula (h0): prop1 = prop2
- Hipótesis Alternativa (h1): prop1 != prop2



## 3.3 Test

Estamos tratando con proporciones independientes y con covarianza desconocida pero estimable, dado que :
- Son independientes puesto que no estamos tratando de relacionar el mismo país en distintas franjas de tiempo, si no que tenemos una compartiva con múltiples países entre sí.
- La varianza es desconocida puesto que estamos usando datos muestrales para estimar las proporciones poblacionales.  
Además, el test a realizar ha de ser bilateral puesto que necesitamos probar que las proporciones no sean iguales.

Por tanto, ya que tenemos unas poblaciones de tamaño reducido, por lo que usaremos el test de Fisher.

## 3.4 Aplicación del test

Al estar en el caso de una proporción no es necesario realizar test de homocedasticidad, puesto que la varianza de la proporción
esta ligada a ella misma.


```{r}
# Tenemos que recalcular los datos, ya que a nivel visual nos interesa mostrar las distintas democracias y autocracias 
# A nivel de cálculo solo diferenciaremos entre democracias y autocracias.


# 1. Cambiamos los datos en regime para que sea binario
df_proporciones <- df_proporciones %>%
  mutate(
    Regime_Binario = case_when(
      Regime %in% c("Closed Autocracy", "Electoral Autocracy") ~ "Autocratic",
      Regime %in% c("Electoral Democracy", "Liberal Democracy") ~ "Democratic"
    )
  )

# 2. Recalcular las sumas de éxitos y totales para los 2 grupos (preparación para el Z Test)
datos_test_fisher <- df_proporciones %>%
  filter(Regime_Binario %in% c("Democratic", "Autocratic")) %>%
  group_by(Regime_Binario) %>%
  summarise(
    Exitos = sum(HighInequality),
    N_Total = n()
  ) %>%
  ungroup()

print(datos_test_fisher)

# 3. Extraer los datos:
exitos_dem <- datos_test_fisher %>% filter(Regime_Binario == "Democratic") %>% pull(Exitos)
n_dem <- datos_test_fisher %>% filter(Regime_Binario == "Democratic") %>% pull(N_Total)

exitos_aut <- datos_test_fisher %>% filter(Regime_Binario == "Autocratic") %>% pull(Exitos)
n_aut <- datos_test_fisher %>% filter(Regime_Binario == "Autocratic") %>% pull(N_Total)

# 1. Definir la matriz de contingencia (Filas: Tipo de Régimen; Columnas: Desigualdad)
# Relleno de la matriz: [A_Exitos, A_Fracasos; D_Exitos, D_Fracasos]
matriz_fisher <- matrix(
  c(exitos_aut, n_aut - exitos_aut, # Autocrático: Éxitos y Fracasos
    exitos_dem, n_dem - exitos_dem), # Democrático: Éxitos y Fracasos
  nrow = 2,
  byrow = TRUE # Indica como introducimos por filas (primero Autocrático, luego Democrático)
)

# Nombrar las dimensiones (Mayor legilibilidad)
rownames(matriz_fisher) <- c("Autocratic", "Democratic")
colnames(matriz_fisher) <- c("GINI > 40 (Exito)", "GINI <= 40 (Fracaso)")

print(matriz_fisher)

# 4. Realizamos el cálculo

test_fisher_resultado <- fisher.test(
  matriz_fisher, 
  alternative = "two.sided" # Ya que el test es bilateral
)

print(test_fisher_resultado)

```


## 3.5 Desarrollo

Debido a la dificultad que presenta el cálculo de forma manual del test de Fisher, realizaremos dicho cálculo mediante el test Z.

```{r}
# H0: p1 = p2
# H1: p1 != p2

# Calculamos proporciones muestrales

x1 <- datos_test_fisher$Exitos[1] # Paises democráticos con GINI > 40
n1 <- datos_test_fisher$N_Total[1] # Paises democráticos 

x2 <- datos_test_fisher$Exitos[2] # Paises autocráticos con GINI > 40
n2 <- datos_test_fisher$N_Total[2] # Paises autocráticos 

# Proporciones muestrales:
p1 <- x1 / n1
p2 <- x2 / n2

# 1. Calcular la Proporción Combinada (pc)
# p_c <- (n1*p1 + n2*p2) / (n1+n2) 
p_combinada <- (x1 + x2) / (n1 + n2)

# 2. Calcular el Estadístico Z (Zobs)
# Si usamos la fórmula (17) de la H0: p1 = p2
# Z = (p1 - p2) / sqrt(pc * (1 - pc) * (1/n1 + 1/n2))
Zobs <- (p1 - p2) / (sqrt(p_combinada * (1 - p_combinada) * (1/n1 + 1/n2)))

# 3. Calcular el Valor Crítico (Zcrit)
# al 95% (alfa = 0.05) ==>(1 - 0.05/2).
ZCrit <- qnorm(0.025, lower.tail=FALSE) 

# 4. Calcular el Valor p (pvalue)
# Siendo un test bilateral debemos multiplicar por 2 la probabilidad
p_value_manual <- 2 * pnorm(abs(Zobs), lower.tail=FALSE)


```


## 3.6 Resultados

```{r}
resultados_Z_manual <- c(Zobs, ZCrit, p_value_manual)
names(resultados_Z_manual) <- c("Zobs", "Z Critico (alpha=0.05)", "p_value (Bilateral)")

print(resultados_Z_manual)


```

## 3.7 Interpretación

Dado que tenemos un valor Z Observado menor que el valor ZCritico (0.1376 < 1.9599) no podemos rechazar H0, esto se ve apoyado por 
el pvalue, el cual es de 0.8904 siendo mayor que el valor alpha. Además si nos centramos en lo mostrado por el test de Fisher, podemos ver que el intervalo de confianza es [0.2499, 4.205], estando el valor observado contenido en el mismo.
Por tanto podemos afirmar con un 95% de confianza que: no podemos afirmar que la proporción de países con alta desigualdad sea diferente entre los regímenes democráticos y autocráticos.


# 4 Proporción de países que cumplen con el objetivo de no agotamiento de bosques


**PR4: ¿La proporción de países que cumplen con el objetivo de no agotamiento neto de bosques
es mayor que 50 %?**

## 4.1 Análisis Descriptivo
Realizaré un gráfico ordenado con los 20 países con el FOR más alto ordenados alfabeticamente por país.

```{r}
dt4 <- worldSustainabiltyDataSet %>%
  rename(FOR = NY.ADJ.DFOR.GN.ZS) %>%
  filter(Year == 2018) 

dt4_Grf <- dt4 %>% group_by(Country) %>% summarise(Total_FOR = sum(FOR, na.rm = TRUE)) %>% ungroup()

dt4_Grf <- dt4_Grf %>% arrange(desc(Total_FOR))


ggplot(head(dt4_Grf,20), aes(x = Country, y = Total_FOR)) +
  geom_col(fill = "steelblue") + # Usa geom_col para barras de valores pre-calculados
  labs(
    title = "Variación de FOR por País",
    x = "País",
    y = "Suma de FOR" # Cambia la etiqueta si usas la media
  ) +
  # Gira las etiquetas del eje X para mayor legibilidad si hay muchos países
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

length(dt4$Country)

```

## 4.2 Hipótesis

Teniendo la pregunta PR4:¿La proporción de países que cumplen con el objetivo de no agotamiento neto de bosques
es mayor que 50 %?  
- n: Paises del mundo (173)
- H0: p = 50 
- H1: p > 50


## 4.3 Test 

El test será aplicado en una población suficientemente grande por lo que se puede asumir una distribución normal, con una varianza desconocida puesto que la variable country es categórica y no numérica, por tanto usaremos un test Z para un Test Unilateral derecho.

## 4.4 Aplicación del Test 
```{r}

dt4_exitos <- dt4 %>% filter(!is.na(FOR)) %>%
  mutate(
    Cumple_Objetivo = ifelse(FOR <= 0, 1, 0) # 1 si se cumple (agotamiento es <= 0), 0 si no se cumple (agotamiento es > 0)
  )
  
n <- length(dt4$FOR) 
prop.test(
  x= sum(dt4_exitos$Cumple_Objetivo),
  n = n,
  p = 0.5, #El objetivo es el 50%
  alternative = "greater", # Test unilateral derecho
  correct = TRUE # Maxima precisión
)

```

## 4.5 Desarrollo 

```{r}

x <- sum(dt4_exitos$Cumple_Objetivo)
pobs <- x / n 
p0 <- 0.5
# 1. Calcular el Error Estándar (SE) bajo H0
SE_H0 <- sqrt(p0 * (1 - p0) / n)

# 2. Calcular el Estadístico Z 
numerador_z <- (pobs - p0) - (0.5 / n)
Z_calc <- numerador_z / SE_H0
pL <- pobs - Z_calc*SE_H0
pU <- pobs + Z_calc*SE_H0

# 3. Calcular el Valor p para el Test UNILATERAL DERECHO
pvalue_final <- pnorm(Z_calc, lower.tail = FALSE)

# --- Output Final (Z_corr y PValue) ---
resultados_finales <- c(
  round(Z_calc, 6),
  round(pvalue_final, 6)
)
names(resultados_finales) <- c("Zobs (Corregido)", "PValue (Corregido)")

print(resultados_finales)


```

## 4.6 Resultados

```{r}

resultados_Z_manual <- c( round(Z_calc, 6), pL, pU, round(pvalue_final,4))
names(resultados_Z_manual) <- c("Zobs", "Limite Inferior", "Limite Superior", "PValue")

print(resultados_Z_manual)

```

## 4.7 Interpretación 

Basandonos en los resultados obtenidos podemos aceptar la hipótesis nula con confianza del 95% puesto que el valor del 50% 
cae dentro del intervalo de confianza [0.503, 0.595], además esto se ve confirmado por el valor del pValue que es superior al 
valor alfa 0.05 (0.05 < 0.11), por tanto: La proporción de países que cumplen con el objetivo de 
no agotamiento neto de bosques es igual al 50 %.


# 5 Conclusiones y comunicación del resultados

```{r}
# --- Creación de la Tabla de Resumen ---
tabla_final_resumen <- tribble(
  ~`Pregunta de Investigación`, ~`Tipo de Test`, ~`Hipótesis Nula`,~`Hipótesis Alternativa`, ~`Valor p Obtenido`, ~`Decisión e Interpretación (alpha=0.05)`,
  # PR1: Esperanza de Vida
  "1. Esperanza de Vida (LE)",
  "Test t de Welch (Dos Muestras, sigma^2 distintas)",
  "H0: mu1 = mu2",
  "H1: mu1 > mu2 (mu1 = Alto Ingreso)",
  "~ < 2.2e-16",
  "**Rechazar H0**. El p-value es extremadamente pequeño. Se afirma que la esperanza de vida en países de alto ingreso es significativamente mayor que en el resto.",
  
  # PR2: Desigualdad a lo largo del tiempo
  "2. Desigualdad (GINI) 2008 vs. 2018",
  "Test t para dos muestras (Varianzas iguales)",
  "H0: mu2008 = mu2018 ",
  "H1: mu2008 > mu2018 (Reducción de desigualdad)",
  "~ 0.095584",
  "**No Rechazar H0**. El p-value es mayor que 0.05. No hay evidencia para afirmar que la desigualdad global se haya reducido significativamente.",
  
  # PR3: Desigualdad según el tipo de régimen
  "3. Desigualdad por Régimen",
  "Test Exacto de Fisher (o Test Z para dos proporciones)",
  "H0: pDem = pAut",
  "H1: pDem != pAut (Proporción GINI > 40 es diferente)",
  "~ 1 (Fisher); 0.8905 (Z Manual)",
  "**No Rechazar H0**. El p-value es muy alto. No se puede afirmar que la proporción de alta desigualdad sea diferente entre regímenes democráticos y autocráticos.",
  
  # PR4: Cumplimiento objetivo de bosques
  "4. Bosques (FOR) vs. 50%",
  "Test Z para una proporción (con corrección de continuidad)",
  "H0: p = 0.50",
  "H1: p > 0.50 (Proporción FOR <= 0 es mayor que 50%)",
  "~ 0.1119",
  "**No Rechazar H0**. El p-value es mayor que 0.05. No hay evidencia para afirmar que la proporción de países que cumplen el objetivo sea mayor al 50%."
)

# Imprimir la tabla en formato Markdown usando knitr::kable
kable(tabla_final_resumen, format = "pipe", align = c('l', 'l', 'l', 'c', 'l'))

```















